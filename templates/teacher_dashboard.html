{% extends "base.html" %}

{% block title %}Teacher Dashboard{% endblock %}

{% block header %}Welcome, {{ teacher.name }}!{% endblock %}

{% block content %}
<h3>Your Instruments: {{ teacher.instruments }}</h3>

<section>
    <h2>ğŸ“š Your Students</h2>
    {% if students %}
        <table border="1">
            <tr>
                <th>Student Name</th>
                <th>Instrument</th>
                <th>Progress Score</th>
                <th>Assign Task</th>
            </tr>
            {% for student in students %}
            <tr>
                <td>{{ student.first_name }} {{ student.last_name }}</td>
                <td>{{ student.instrument }}</td>
                <td>{{ student.score }}</td>
                <td>
                    <form action="/assign_task" method="POST">
                        <input type="hidden" name="student_id" value="{{ student.id }}">
                        <input type="text" name="description" placeholder="Enter task">
                        <input type="date" name="due_date"> 
                        <textarea name="feedback_text" placeholder="Write your doubts here..."></textarea>
                        <button type="submit">assign_task</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p>No students assigned yet.</p>
    {% endif %}
</section>
<h2>ğŸ“¢ Validate Student Submissions</h2>
{% if completed_tasks %}
<table border="1">
    <tr>
        <th>Task ID</th>
        <th>Description</th>
        <th>Student Name</th>
        <th>Submission</th>
        <th>Validate</th>
    </tr>
    {% for task in completed_tasks %}
        <tr>
            <td>{{ task.id }}</td>
            <td>{{ task.description }}</td>
            <td>{{ task.student_name }}</td>
            <td>
                {% if task.submissions %}
                    <a href="{{ task.submissions }}" target="_blank">View Submission</a>
                {% else %}
                    <p>No submission yet.</p>
                {% endif %}
            </td>
            <td>
                <form action="/validate_submission" method="POST">
                    <input type="hidden" name="task_id" value="{{ task.id }}">
                    <button type="submit">Mark as Validated</button>
                </form>
            </td>
        </tr>
    {% endfor %}
</table>
{% else %}
    <p>No completed tasks yet.</p>
{% endif %}

<h2>ğŸ“¢ Doubts from Students</h2>
{% if student_doubts %}
    <ul>
        {% for entry in student_doubts %}
            <li><strong>{{ entry.doubts }}</strong> - Sent by {{ entry.student_name }}</li>
        {% endfor %}
    </ul>
{% else %}
    <p>No Doubts received yet.</p>
{% endif %}
{% endblock %}
